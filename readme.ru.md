# Reduction

Reduction предназначено для оптимизации размера изображений на сайте. Нередко пользователи загружают на сервер слишком большие изображения :)<br> 
Логика работы приложения следующая: сначала инспектируются директории на наличие файлов изображений (jpeg, png, gif) больших определённого размера, затем может быть произведена перезапись найденных файлов с оптимальной шириной и высотой (пропорции остануться правильными). Поиск файлов осуществляется рекурсивно.<br>
Выбирать изображения можно не только по размеру файла, но и по размеру "длинной" стороны изображения. Настройки помещены в файл `data/config.json`.<br>
Чтобы ориентироваться сколько приложение выполняется по времени и потребляет памяти написан класс Marker. Результаты пишутся в лог.<br><br>

Посмотрим на файл `data/config.json`, в нём:<br>
`"folderPath"` - путь к директории изображений, относительно директории `reduction`<br>
`"mode"` - режим выбора изображений либо `"ImageSide"`, либо `"FileSize"`<br>
`"maxFileSize"` - в режиме `"FileSize"` будут выбраны файлы больше указанного размера в байтах<br>
`"maxImageSide"` - в режиме `"ImageSide"` будут выбраны файлы, у которых длинная сторона больше указанного здесь значения в пикселях<br>
`"maxWidth"` - ширина новых изображений, если изображения горизонтальные в пикселях<br>
`"maxHeight"` - высота новых изображений, если изображения вертикальные в пикселях<br>
`"ableTypes"` - массив расширений файлов, необязательно там должно быть 3 значения, выберите одно или два для "точечной" работы<br>
`"quality"` - показатель `quality` при записи jpeg и png изображений функциями imagejpeg(), imagepng()<br><br>

Таким образом код для типового применения может выглядеть так:<br>
```php
chdir(__DIR__);
require_once __DIR__.'/src/Loader/Loader.php';
\Loader\Loader::autoload(true, __DIR__."/src");

use Logger\Logger;
use Reduction\Marker;
use Reduction\Reduction;

$log = new Logger("data/app.log");
$marker = new Marker($log);

// создаём экземпляр Reduction, получаем список файлов, печатаем в лог
$reduct = new Reduction($log, "data/config.json");
$reduct->getList();  // создает список отфильтрованных файлов
$reduct->printList();
$marker->addMark();  // добавление метки времени

// уменьшаем размер файлов по списку, уничтожаем экземпляр Reduction
$reduct->reductAll(); // перезапись файлов
$reduct = null;
$marker->addMark();

// проверяем, что получилось
$reduct = new Reduction($log, "data/config.json");
$reduct->getList();
$reduct->printList();
$marker->addMark();

$marker->display();
```
Смотрите также файл `app.php`<br>

## Использование
Содержимое данного репозитория поместите на сервер в директорию `reduction`, например, так
```bash
$ git clone https://github.com/navt/reduction.git
```
Отредактируйте `data/config.json` и `app.php` в соответствии с вашей текущей задачей.<br>
В консоли перейдите в директорию `reduction`. Запустите скрипт<br>
`$ php -f app.php`<br>
Использование консоли является предпочтительным, потому что при достаточно больших объёмах изображений приложению потребуется время для решения задачи.<br> 
Позаботьтесь о безопасности своих данных: сделайте дамп директорий, где планируется проводить работы, запустите скрипт на тестовых данных на локальном компьютере, посмотрите, удовлетворяет ли вас результат.

### Ограничения
Скрипт не работает с gif-изображениями, имеющими несколько слоёв.

### Ссылка
[Оптимизация размера изображений на сайте](https://instantcms.ru/blogs/pobochnyi-yefekt/optimizacija-razmera-izobrazhenii-na-saite.html)